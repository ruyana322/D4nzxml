<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>4KFX Ultra</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{background:#0a0a0a;color:#f0f0f0;font-family:'Inter',sans-serif;min-height:100vh;display:flex;flex-direction:column;align-items:center;padding:24px 16px 60px}
.logo{font-size:12px;letter-spacing:8px;color:#555;margin:28px 0 32px}
.logo b{color:#fff}
.card{width:100%;max-width:500px;background:#141414;border:1px solid #222;border-radius:16px;padding:18px;margin-bottom:10px}
.lbl{font-size:9px;letter-spacing:3px;color:#444;margin-bottom:12px}
.row{display:flex;gap:8px}
.inp{flex:1;background:#0d0d0d;border:1px solid #222;border-radius:10px;padding:11px 13px;color:#fff;font-size:13px;font-family:'Inter',sans-serif;outline:none}
.inp:focus{border-color:#fff}
.inp::placeholder{color:#333}
.btn{background:#fff;border:none;border-radius:10px;padding:11px 16px;color:#000;font-weight:600;font-size:12px;cursor:pointer}
.btn:hover{background:#e0e0e0}
.btn.sm{background:transparent;border:1px solid #333;color:#888;padding:7px 12px;font-size:11px;border-radius:8px}
.btn.sm:hover{border-color:#fff;color:#fff}
.btn.green{background:#22c55e;color:#000}
.srow{display:flex;align-items:center;gap:8px;margin-top:10px}
.dot{width:6px;height:6px;border-radius:50%;background:#333}
.dot.on{background:#22c55e;box-shadow:0 0 6px #22c55e}
.stxt{font-size:11px;color:#555}
.drop{width:100%;max-width:500px;border:1px dashed #222;border-radius:16px;padding:44px 20px;text-align:center;cursor:pointer;margin-bottom:10px}
.drop:hover{border-color:#555;background:rgba(255,255,255,.02)}
.di{font-size:30px;display:block;margin-bottom:10px}
.dt{font-size:14px;font-weight:500;margin-bottom:4px}
.ds{font-size:11px;color:#444}
input[type=file]{display:none}
.fi{display:none;width:100%;max-width:500px;background:#141414;border:1px solid #222;border-radius:12px;padding:12px 14px;align-items:center;gap:10px;margin-bottom:10px}
.fi.show{display:flex}
.fn{font-size:13px;font-weight:500;flex:1;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.fm{font-size:10px;color:#555;margin-top:2px}
.ctrl{display:none;flex-direction:column;gap:10px;width:100%;max-width:500px}
.ctrl.show{display:flex}
.qg{display:grid;grid-template-columns:repeat(4,1fr);gap:6px}
.qb{padding:11px 4px;background:#0d0d0d;border:1px solid #222;border-radius:10px;color:#555;font-size:11px;font-weight:500;cursor:pointer;text-align:center}
.qb .qs{font-size:8px;display:block;margin-top:2px;opacity:.6}
.qb:hover{border-color:#555;color:#fff}
.qb.active{border-color:#fff;color:#fff;background:#1a1a1a}
.go{width:100%;padding:14px;background:#fff;border:none;border-radius:12px;color:#000;font-size:13px;font-weight:600;cursor:pointer;letter-spacing:.5px}
.go:hover{background:#e0e0e0}
.go:disabled{opacity:.3;cursor:not-allowed}
.pw{display:none;width:100%;max-width:500px}
.pw.show{display:block}
.pl{display:flex;justify-content:space-between;font-size:9px;color:#444;letter-spacing:2px;margin-bottom:6px}
.pl span{color:#fff}
.pt{background:#1a1a1a;border-radius:100px;height:3px}
.pb{height:100%;width:0%;border-radius:100px;background:#fff;transition:width .3s}
.sp{display:none;background:#141414;border:1px solid #222;border-radius:14px;padding:16px}
.sp.show{display:block}
.sph{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
.spt{font-size:9px;letter-spacing:3px;color:#555}
.spid{font-size:9px;color:#333;font-family:monospace}
.steps{display:flex;gap:5px;margin-bottom:10px}
.step{flex:1;padding:6px 2px;background:#0d0d0d;border:1px solid #1a1a1a;border-radius:7px;font-size:7px;letter-spacing:1px;color:#333;text-align:center;transition:all .3s}
.step.on{border-color:#fff;color:#fff}
.step.done{border-color:#22c55e;color:#22c55e}
.pt2{background:#1a1a1a;border-radius:100px;height:3px;margin-bottom:8px}
.pb2{height:100%;width:0%;border-radius:100px;background:linear-gradient(90deg,#444,#fff);transition:width .5s}
.sm2{font-size:10px;color:#444;text-align:center;letter-spacing:1px}
.rp{display:none;background:#141414;border:1px solid #1c2a1c;border-radius:14px;padding:18px;text-align:center}
.rp.show{display:flex;flex-direction:column;gap:12px}
.rt{font-size:10px;letter-spacing:4px;color:#22c55e}
video{width:100%;border-radius:10px;max-height:240px;background:#000}
.rs{font-size:9px;color:#444;letter-spacing:1px}
.ra{display:flex;gap:8px;justify-content:center}
.toast{position:fixed;bottom:20px;left:50%;transform:translateX(-50%) translateY(80px);background:#1c1c1c;border:1px solid #333;border-radius:10px;padding:10px 18px;font-size:11px;color:#fff;opacity:0;transition:all .3s;white-space:nowrap;z-index:99}
.toast.show{transform:translateX(-50%) translateY(0);opacity:1}
.toast.err{border-color:#ef4444;color:#ef4444}
.cr{margin-top:28px;text-align:center}
.cr p{font-size:8px;letter-spacing:3px;color:#333;margin-bottom:6px}
.cr div{display:flex;gap:18px;justify-content:center}
.cr span{font-size:10px;font-weight:600;color:#444}
</style>
</head>
<body>

<div class="logo">4K <b>FX</b> ULTRA</div>

<div class="card">
  <div class="lbl">API KEY</div>
  <div class="row">
    <input type="password" class="inp" id="ki" placeholder="r8_xxxxxxxxxxxxxxxxxxxx">
    <button class="btn" onclick="saveKey()">Simpan</button>
  </div>
  <div class="srow">
    <div class="dot" id="dot"></div>
    <div class="stxt" id="stxt">API Key belum diset</div>
  </div>
</div>

<div class="drop" id="drop" onclick="document.getElementById('fi').click()">
  <input type="file" id="fi" accept="video/*" onchange="loadFile(this.files[0])">
  <span class="di">ðŸŽ¬</span>
  <div class="dt">Pilih atau drop video</div>
  <div class="ds">MP4 Â· MOV Â· WebM Â· Maks 4MB</div>
</div>

<div class="fi" id="finfo">
  <div style="font-size:22px">ðŸŽ¥</div>
  <div style="flex:1;min-width:0">
    <div class="fn" id="fn"></div>
    <div class="fm" id="fm"></div>
  </div>
  <button class="btn sm" onclick="document.getElementById('fi').click()">Ganti</button>
</div>

<div class="ctrl" id="ctrl">
  <div class="card" style="padding:14px">
    <div class="lbl">KUALITAS</div>
    <div class="qg">
      <button class="qb" data-q="SD" onclick="setQ(this)">SD<span class="qs">480p</span></button>
      <button class="qb active" data-q="HD" onclick="setQ(this)">HD<span class="qs">720p</span></button>
      <button class="qb" data-q="FHD" onclick="setQ(this)">FHD<span class="qs">1080p</span></button>
      <button class="qb" data-q="4K" onclick="setQ(this)">4K<span class="qs">Ultra</span></button>
    </div>
  </div>
  <button class="go" id="go" onclick="run()">Mulai Enhance</button>

  <div class="pw" id="pw">
    <div class="pl">UPLOAD<span id="pct">0%</span></div>
    <div class="pt"><div class="pb" id="pb"></div></div>
  </div>

  <div class="sp" id="sp">
    <div class="sph">
      <div class="spt">MEMPROSES</div>
      <div class="spid" id="spid"></div>
    </div>
    <div class="steps">
      <div class="step" id="s1">UPLOAD</div>
      <div class="step" id="s2">QUEUE</div>
      <div class="step" id="s3">AI</div>
      <div class="step" id="s4">DONE</div>
    </div>
    <div class="pt2"><div class="pb2" id="pb2"></div></div>
    <div class="sm2" id="sm2">Mempersiapkan...</div>
  </div>

  <div class="rp" id="rp">
    <div class="rt">âœ“ SELESAI</div>
    <video id="vid" controls playsinline></video>
    <div class="rs" id="rs"></div>
    <div class="ra">
      <a class="btn green" id="dl" target="_blank" download>â†“ Download</a>
      <button class="btn sm" onclick="reset()">Video Baru</button>
    </div>
  </div>
</div>

<div class="cr">
  <p>CREATED BY</p>
  <div><span>@D4nzxml</span><span>@DadanRi</span><span>@KenzinTzy</span></div>
</div>

<div class="toast" id="toast"></div>

<script>
var key='',file=null,q='HD';

(function(){
  var k=localStorage.getItem('fxkey');
  if(k){key=k;document.getElementById('ki').value=k;setDot(true);}
})();

function saveKey(){
  var v=document.getElementById('ki').value.trim();
  if(!v)return toast('Masukkan API key!',1);
  if(v.indexOf('r8_')!==0)return toast('Token harus diawali r8_',1);
  key=v;localStorage.setItem('fxkey',v);setDot(true);toast('API Key tersimpan!');
}

function setDot(ok){
  document.getElementById('dot').className='dot'+(ok?' on':'');
  document.getElementById('stxt').textContent=ok?'âœ“ API Key aktif':'API Key belum diset';
}

var drop=document.getElementById('drop');
drop.ondragover=function(e){e.preventDefault();drop.style.borderColor='#fff'};
drop.ondragleave=function(){drop.style.borderColor='#222'};
drop.ondrop=function(e){
  e.preventDefault();drop.style.borderColor='#222';
  var f=e.dataTransfer.files[0];
  if(f&&f.type.indexOf('video')===0)loadFile(f);
  else toast('Harus file video!',1);
};

function loadFile(f){
  if(!f)return;
  if(f.size>4*1024*1024)return toast('Maks 4MB!',1);
  file=f;
  document.getElementById('fn').textContent=f.name;
  document.getElementById('fm').textContent=(f.size/1024/1024).toFixed(1)+' MB';
  document.getElementById('drop').style.display='none';
  document.getElementById('finfo').classList.add('show');
  document.getElementById('ctrl').classList.add('show');
  document.getElementById('rp').classList.remove('show');
  document.getElementById('sp').classList.remove('show');
  toast('Video siap!');
}

function setQ(btn){
  document.querySelectorAll('.qb').forEach(function(b){b.classList.remove('active')});
  btn.classList.add('active');q=btn.getAttribute('data-q');
}

async function run(){
  if(!key)return toast('Set API key dulu!',1);
  if(!file)return toast('Pilih video dulu!',1);
  var go=document.getElementById('go');
  go.disabled=true;go.textContent='Memproses...';
  document.getElementById('sp').classList.add('show');
  document.getElementById('rp').classList.remove('show');
  document.getElementById('pw').classList.add('show');
  setStep(1);setP(5,'Membaca file...');
  try{
    var url=await upload(file);
    document.getElementById('pw').classList.remove('show');
    setP(32,'Upload sukses!');setStep(2);
    var cr=await fetch('/api/replicate?action=create',{
      method:'POST',
      headers:{'Content-Type':'application/json','x-api-key':key},
      body:JSON.stringify({videoUrl:url,quality:q})
    });
    var cd=await cr.json();
    if(!cr.ok)throw new Error(cd.error||'Gagal create');
    document.getElementById('spid').textContent='ID:'+cd.id.slice(0,8);
    setP(40,'Antrian AI...');setStep(2);
    var out=await poll(cd.id);
    setP(100,'Selesai!');setStep(4);
    await sleep(400);
    document.getElementById('sp').classList.remove('show');
    document.getElementById('rp').classList.add('show');
    document.getElementById('vid').src=out;
    document.getElementById('dl').href=out;
    document.getElementById('rs').textContent='Kualitas: '+q+' Â· Real-ESRGAN AI';
    toast('Berhasil di-enhance!');
  }catch(e){
    document.getElementById('pw').classList.remove('show');
    toast(e.message,1);setP(0,'Error: '+e.message);
  }
  go.disabled=false;go.textContent='Mulai Enhance';
}

function upload(f){
  return new Promise(function(res,rej){
    var reader=new FileReader();
    reader.onload=async function(e){
      try{
        var b64=e.target.result.split(',')[1];
        document.getElementById('pb').style.width='60%';
        document.getElementById('pct').textContent='60%';
        setP(18,'Mengupload...');
        var r=await fetch('/api/replicate?action=upload',{
          method:'POST',
          headers:{'Content-Type':'application/json','x-api-key':key},
          body:JSON.stringify({data:b64,type:f.type||'video/mp4'})
        });
        var d=await r.json();
        if(!r.ok)rej(new Error(d.error||'Upload gagal'));
        else{document.getElementById('pb').style.width='100%';document.getElementById('pct').textContent='100%';res(d.url);}
      }catch(err){rej(err);}
    };
    reader.onerror=function(){rej(new Error('Gagal baca file'))};
    reader.readAsDataURL(f);
  });
}

async function poll(id){
  for(var n=0;n<180;n++){
    await sleep(3000);
    var r=await fetch('/api/replicate?action=poll&id='+id,{headers:{'x-api-key':key}});
    var d=await r.json();
    if(!r.ok)throw new Error(d.error||'Poll error');
    var p=Math.min(95,40+(n/180)*55);
    if(d.status==='succeeded'){
      var o=Array.isArray(d.output)?d.output[0]:d.output;
      if(!o)throw new Error('Output kosong');return o;
    }
    if(d.status==='failed')throw new Error(d.error||'AI gagal');
    if(d.status==='processing'){setStep(3);setP(p,'AI memproses... '+n*3+'s');}
    else if(d.status==='starting'){setStep(2);setP(42,'AI loading...');}
  }
  throw new Error('Timeout. Coba video lebih pendek.');
}

function setStep(n){
  ['s1','s2','s3','s4'].forEach(function(id,i){
    document.getElementById(id).className='step'+(i+1<n?' done':i+1===n?' on':'');
  });
}
function setP(p,m){document.getElementById('pb2').style.width=p+'%';document.getElementById('sm2').textContent=m;}
function sleep(ms){return new Promise(function(r){setTimeout(r,ms)});}

function reset(){
  file=null;document.getElementById('fi').value='';
  document.getElementById('drop').style.display='';
  document.getElementById('finfo').classList.remove('show');
  document.getElementById('ctrl').classList.remove('show');
  document.getElementById('rp').classList.remove('show');
  document.getElementById('sp').classList.remove('show');
  document.getElementById('pw').classList.remove('show');
  document.getElementById('vid').src='';
}

var tt;
function toast(m,e){
  var t=document.getElementById('toast');
  t.textContent=m;t.className='toast show'+(e?' err':'');
  clearTimeout(tt);tt=setTimeout(function(){t.classList.remove('show');},3000);
}
</script>
</body>
</html>
